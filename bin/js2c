#!/usr/bin/env node
var args = require('../lib/cli')
  .helpfile(__dirname+'/../Usage.txt')
  .version(require('../package.json').version)
  .minimist({
    boolean: ['ast'],
    alias: { h: 'help', v: 'version' }
  });

var read = require('read-input');
var js2coffee = require('../index');

read(args._, function (err, res) {
  if (err) {
    console.error(err);
    process.exit(8);
  }

  res.successes.forEach(function (file) {
    var data = file.data;
    try {
      var out = js2coffee.build(data, { filename: file.name || '[stdin]' });
      if (args.ast) {
        process.stdout.write(inspect(out.ast));
      } else {
        process.stdout.write(out.code);
      }
    } catch (err) {
      console.error(err.message);
      if (!err.js2coffee)
        console.error(err.stack);
      process.exit(16);
    }
  });
});

function inspect(data) {
  return require('util').inspect(data, { depth: null });
}
